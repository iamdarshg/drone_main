<deployment>
  <instance
    name="gpio"
    type="Hal::Gpio"
  />
  <instance
    name="i2c"
    type="Hal::I2c"
  />
  <instance
    name="spi"
    type="Hal::Spi"
  />
  <instance
    name="uart"
    type="Hal::Uart"
  />
  <instance
    name="can"
    type="Hal::Can"
  />
  <instance
    name="imu"
    type="Sensors::Lsm6ds3"
  />
  <instance
    name="baro"
    type="Sensors::Icp101xx"
  />
  <instance
    name="gps"
    type="Sensors::Neo6m"
  />
  <instance
    name="sensor_fusion"
    type="FSW::SensorFusion"
  />
  <instance
    name="pid"
    type="Control::Pid"
  />
  <instance
    name="mixer"
    type="Control::Mixer"
  />
  <instance
    name="motor1"
    type="Actuators::Motor"
  />
  <instance
    name="motor2"
    type="Actuators::Motor"
  />
  <instance
    name="motor3"
    type="Actuators::Motor"
  />
  <instance
    name="motor4"
    type="Actuators::Motor"
  />
  <instance
    name="pyro"
    type="Actuators::Pyro"
  />
  <instance
    name="navigation"
    type="Navigation::Navigation"
  />
  <connections>
    <!-- Connect HAL to sensors -->
    <connection name="imu_i2c" source="i2c.i2c" target="imu.i2c"/>
    <connection name="baro_i2c" source="i2c.i2c" target="baro.i2c"/>
    <connection name="gps_uart" source="uart.uart" target="gps.uart"/>

    <!-- Connect sensors to sensor fusion -->
    <connection name="imu_data" source="imu.imu" target="sensor_fusion.imuIn"/>
    <connection name="baro_data" source="baro.pressure" target="sensor_fusion.pressureIn"/>
    <connection name="gps_data" source="gps.gps" target="sensor_fusion.gpsIn"/>

    <!-- Connect sensor fusion to PID -->
    <connection name="attitude_data" source="sensor_fusion.attitude" target="pid.attitudeIn"/>

    <!-- Connect navigation to PID -->
    <connection name="guidance_data" source="navigation.guidance" target="pid.setpointIn"/>

    <!-- Connect PID to Mixer -->
    <connection name="actuator_data" source="pid.actuator" target="mixer.actuatorIn"/>

    <!-- Connect Mixer to Motors -->
    <connection name="motor1_speed" source="mixer.motor1" target="motor1.speedIn"/>
    <connection name="motor2_speed" source="mixer.motor2" target="motor2.speedIn"/>
    <connection name="motor3_speed" source="mixer.motor3" target="motor3.speedIn"/>
    <connection name="motor4_speed" source="mixer.motor4" target="motor4.speedIn"/>

    <!-- Connect GPS to navigation -->
    <connection name="gps_nav_data" source="gps.gps" target="navigation.gpsIn"/>
  </connections>
</deployment>
